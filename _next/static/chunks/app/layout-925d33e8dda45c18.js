(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{347:()=>{},2919:(e,t,r)=>{"use strict";r.d(t,{default:()=>b});var i=r(5155),a=r(2115),n=r(4879),o=r(1793),s=r(5695),c=r(2039),l=r(5063);let d=[{id:"home",label:"Home",path:"/main",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})},{id:"explore",label:"Explore",path:"/explore",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})},{id:"tool",label:"Action Tool",path:"/tool",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})},{id:"profile",label:"Profile",path:"/profile",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})},{id:"admin",label:"Admin",path:"/admin",icon:(0,i.jsxs)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}];function h(){var e,t,r;let n=(0,s.usePathname)(),h=(0,s.useRouter)(),{profile:m}=(0,c.x)();(0,a.useEffect)(()=>{(async()=>{for(let e of d)await l.Ew.smartPrefetch(h,e.path)})().catch(console.warn)},[h]);let u=async e=>{try{await l.Ew.navigateTo(h,e,{prefetch:!1})||console.warn("Navigation to ".concat(e," failed, but fallback should have been triggered"))}catch(t){console.error("Navigation error:",t),l.Ew.emergencyNavigate(e)}},p=async()=>{await u("/main")},g=async()=>{await u("/profile")};return(0,i.jsx)(o.P.div,{initial:{x:-100,opacity:0},animate:{x:0,opacity:1},transition:{duration:.5,ease:"easeOut"},children:(0,i.jsxs)("nav",{className:"w-80 h-screen bg-card border-r border-grayBorder flex flex-col",children:[(0,i.jsx)("div",{className:"p-8 border-b border-grayBorder",children:(0,i.jsx)(o.P.div,{whileHover:{scale:1.02},children:(0,i.jsxs)("div",{onClick:p,className:"cursor-pointer",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-text mb-2",children:"Science for Action"}),(0,i.jsx)("p",{className:"text-grayText text-sm",children:"Science for people who give a shit"})]})})}),(0,i.jsxs)("div",{className:"flex-1 p-6",children:[(0,i.jsx)("div",{className:"space-y-2",children:d.map(e=>{let t=n.startsWith(e.path);return(0,i.jsx)(o.P.div,{whileHover:{scale:1.02,x:4},whileTap:{scale:.98},children:(0,i.jsxs)("button",{onClick:()=>u(e.path),className:"w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 ".concat(t?"bg-primary text-white shadow-sm":"text-grayText hover:text-text hover:bg-graySoft"),"aria-label":"Navigate to ".concat(e.label),children:[(0,i.jsx)("div",{className:"".concat(t?"text-white":"text-grayText"),children:e.icon}),(0,i.jsx)("span",{className:"font-medium",children:e.label}),t&&(0,i.jsx)(o.P.div,{layoutId:"activeIndicator",children:(0,i.jsx)("div",{className:"ml-auto w-2 h-2 bg-white rounded-full"})})]})},e.id)})}),m&&(0,i.jsx)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,i.jsxs)("div",{className:"mt-8 p-4 bg-graySoft rounded-xl",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-text mb-3",children:"Your Impact"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{className:"text-grayText",children:"Actions Completed"}),(0,i.jsx)("span",{className:"font-medium text-text",children:(null==(e=m.contribution_stats)?void 0:e.actions_completed)||0})]}),(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{className:"text-grayText",children:"Policies Viewed"}),(0,i.jsx)("span",{className:"font-medium text-text",children:(null==(t=m.contribution_stats)?void 0:t.policies_viewed)||0})]}),(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{className:"text-grayText",children:"Organizations"}),(0,i.jsx)("span",{className:"font-medium text-text",children:(null==(r=m.contribution_stats)?void 0:r.organizations_supported)||0})]})]})]})}),!m&&(0,i.jsx)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,i.jsxs)("div",{className:"mt-8 p-4 bg-primary bg-opacity-10 rounded-xl border border-primary border-opacity-20",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-primary mb-2",children:"Get Started"}),(0,i.jsx)("p",{className:"text-xs text-grayText mb-3",children:"Create your profile to get personalized recommendations and track your impact."}),(0,i.jsx)(o.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,i.jsx)("button",{onClick:g,className:"w-full px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors",children:"Create Profile"})})]})})]}),(0,i.jsx)("div",{className:"p-6 border-t border-grayBorder",children:(0,i.jsxs)("div",{className:"text-xs text-grayText space-y-1",children:[(0,i.jsx)("p",{children:"\xa9 2024 Science for Action"}),(0,i.jsx)("p",{children:"Making science accessible and actionable"})]})})]})})}let m=[{id:"explore",label:"Explore",path:"/explore",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})},{id:"tool",label:"Action Tool",path:"/tool",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})},{id:"profile",label:"Profile",path:"/profile",icon:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}];function u(e){var t,r;let{isOpen:a,onClose:l}=e,d=(0,s.usePathname)(),h=(0,s.useRouter)(),{profile:u}=(0,c.x)(),p=e=>{h.push(e),l()};return(0,i.jsx)(n.N,{children:a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,i.jsx)("div",{onClick:l,className:"fixed inset-0 bg-black bg-opacity-50 z-40"})}),(0,i.jsx)(o.P.div,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",damping:25,stiffness:200},children:(0,i.jsx)("div",{className:"fixed left-0 top-0 h-full w-80 bg-card z-50 shadow-2xl",children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-grayBorder",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-xl font-bold text-text",children:"Science for Action"}),(0,i.jsx)("p",{className:"text-grayText text-sm",children:"Science for people who give a shit"})]}),(0,i.jsx)(o.P.div,{whileTap:{scale:.95},children:(0,i.jsx)("button",{onClick:l,className:"p-2 hover:bg-graySoft rounded-lg transition-colors",children:(0,i.jsx)("svg",{className:"w-6 h-6 text-grayText",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),(0,i.jsxs)("div",{className:"flex-1 p-6",children:[(0,i.jsx)("div",{className:"space-y-2",children:m.map(e=>{let t=d.startsWith(e.path);return(0,i.jsx)(o.P.div,{whileHover:{scale:1.02,x:4},whileTap:{scale:.98},children:(0,i.jsxs)("button",{onClick:()=>p(e.path),className:"w-full flex items-center gap-4 px-4 py-3 rounded-xl transition-all duration-200 ".concat(t?"bg-primary text-white shadow-sm":"text-grayText hover:text-text hover:bg-graySoft"),children:[(0,i.jsx)("div",{className:"".concat(t?"text-white":"text-grayText"),children:e.icon}),(0,i.jsx)("span",{className:"font-medium",children:e.label}),t&&(0,i.jsx)("div",{className:"ml-auto w-2 h-2 bg-white rounded-full"})]})},e.id)})}),u&&(0,i.jsxs)("div",{className:"mt-8 p-4 bg-graySoft rounded-xl",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-text mb-3",children:"Your Impact"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{className:"text-grayText",children:"Actions"}),(0,i.jsx)("span",{className:"font-medium text-text",children:(null==(t=u.contribution_stats)?void 0:t.actions_completed)||0})]}),(0,i.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,i.jsx)("span",{className:"text-grayText",children:"Policies"}),(0,i.jsx)("span",{className:"font-medium text-text",children:(null==(r=u.contribution_stats)?void 0:r.policies_viewed)||0})]})]})]}),!u&&(0,i.jsxs)("div",{className:"mt-8 p-4 bg-primary bg-opacity-10 rounded-xl border border-primary border-opacity-20",children:[(0,i.jsx)("h3",{className:"text-sm font-semibold text-primary mb-2",children:"Get Started"}),(0,i.jsx)("p",{className:"text-xs text-grayText mb-3",children:"Create your profile to get personalized recommendations."}),(0,i.jsx)(o.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,i.jsx)("button",{onClick:()=>p("/profile"),className:"w-full px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors",children:"Create Profile"})})]})]}),(0,i.jsx)("div",{className:"p-6 border-t border-grayBorder",children:(0,i.jsx)("div",{className:"text-xs text-grayText",children:(0,i.jsx)("p",{children:"\xa9 2024 Science for Action"})})})]})})})]})})}class p extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,i.jsx)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:(0,i.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen p-8 bg-background",children:(0,i.jsxs)("div",{className:"max-w-md w-full bg-card rounded-card shadow-card border border-grayBorder p-8 text-center",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary bg-opacity-10 rounded-full flex items-center justify-center",children:(0,i.jsx)("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,i.jsx)("h2",{className:"text-xl font-bold text-text mb-2",children:"Something went wrong"}),(0,i.jsx)("p",{className:"text-grayText mb-4",children:"We encountered an unexpected error. Don't worry, your data is safe."})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)(o.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,i.jsx)("button",{type:"button",onClick:this.handleReset,className:"w-full px-4 py-3 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors",children:"Try again"})}),(0,i.jsx)(o.P.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,i.jsx)("button",{type:"button",onClick:()=>window.location.reload(),className:"w-full px-4 py-3 bg-graySoft text-text rounded-xl font-medium hover:bg-grayBorder transition-colors",children:"Reload page"})})]}),!1]})})}):this.props.children}constructor(e){super(e),this.handleReset=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.state={hasError:!1}}}class g{static getInstance(e){return g.instance||(g.instance=new g(e)),g.instance}createTimeout(e,t){return new Promise((r,i)=>{let a=setTimeout(()=>{i(Error("Request timeout after ".concat(e,"ms")))},e);this.requestTimeouts.set(t,a)})}clearTimeout(e){let t=this.requestTimeouts.get(e);t&&(clearTimeout(t),this.requestTimeouts.delete(e))}getCacheKey(e,t){let r=(null==t?void 0:t.method)||"GET",i=(null==t?void 0:t.body)?JSON.stringify(t.body):"";return"".concat(r,":").concat(e,":").concat(i)}getCachedData(e){if(!this.config.enableCache)return null;let t=this.cache.get(e);return t&&Date.now()<t.expires?t.data:(t&&this.cache.delete(e),null)}setCachedData(e,t){if(!this.config.enableCache)return;let r=Date.now()+this.config.cacheDuration;this.cache.set(e,{data:t,timestamp:Date.now(),expires:r})}async processResponse(e){try{let t,r=new Date().toISOString();if(!e.ok){let t="HTTP ".concat(e.status,": ").concat(e.statusText);try{let r=await e.text();r&&(t=r)}catch(e){}return{success:!1,error:t,code:e.status.toString(),timestamp:r}}let i=e.headers.get("content-type")||"";return t=i.includes("application/json")?await e.json():i.includes("text/")?await e.text():await e.blob(),{success:!0,data:t,timestamp:r}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Response processing failed",timestamp:new Date().toISOString()}}}async fetchWithRetry(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="".concat(Date.now(),"-").concat(Math.random()),a=this.getCacheKey(e,r),n=r.timeout||this.config.timeout,o=null!=(t=r.retryAttempts)?t:this.config.retryAttempts;if(!r.skipCache&&(!r.method||"GET"===r.method)){let e=this.getCachedData(a);if(e)return{success:!0,data:e,timestamp:new Date().toISOString()}}let s=null;for(let t=0;t<=o;t++)try{if(t>0){let e=Math.min(1e3*Math.pow(2,t-1),5e3);await new Promise(t=>setTimeout(t,e))}let o={...r,headers:{"Content-Type":"application/json",...r.headers}},s=fetch(e,o),c=this.createTimeout(n,i),l=await Promise.race([s,c]);this.clearTimeout(i);let d=await this.processResponse(l);return d.success&&(!r.method||"GET"===r.method)&&this.setCachedData(a,d.data),d}catch(r){if(this.clearTimeout(i),s=r instanceof Error?r:Error("Unknown fetch error"),console.warn("Fetch attempt ".concat(t+1," failed:"),{url:e,error:s.message,isRetry:t>0}),s.message.includes("timeout")&&t===o||s.message.includes("AbortError"))break}return{success:!1,error:(null==s?void 0:s.message)||"All fetch attempts failed",code:"FETCH_FAILED",timestamp:new Date().toISOString()}}async fetchServerResponse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!e||"string"!=typeof e)return{success:!1,error:"Invalid endpoint provided",code:"INVALID_ENDPOINT",timestamp:new Date().toISOString()};let r=e.startsWith("/")?e:"/".concat(e),i=window.location.origin,a="".concat(i,"/api").concat(r);return await this.fetchWithRetry(a,t)}catch(e){return{success:!1,error:e instanceof Error?e.message:"Server response fetch failed",code:"SERVER_FETCH_ERROR",timestamp:new Date().toISOString()}}}async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetchWithRetry(e,{...t,method:"GET"})}async post(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.fetchWithRetry(e,{...r,method:"POST",body:t?JSON.stringify(t):void 0})}async put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.fetchWithRetry(e,{...r,method:"PUT",body:t?JSON.stringify(t):void 0})}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetchWithRetry(e,{...t,method:"DELETE"})}clearCache(){this.cache.clear()}cleanupCache(){let e=Date.now();for(let[t,r]of this.cache.entries())e>=r.expires&&this.cache.delete(t)}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}updateConfig(e){this.config={...this.config,...e}}cleanup(){for(let e of this.requestTimeouts.values())clearTimeout(e);this.requestTimeouts.clear(),this.cache.clear()}constructor(e={}){this.config={retryAttempts:2,timeout:1e4,enableCache:!0,cacheDuration:3e5,...e},this.cache=new Map,this.requestTimeouts=new Map}}let f=g.getInstance();class y{static getInstance(e){return y.instance||(y.instance=new y(e)),y.instance}initialize(){this.log("info","Initializing cache cleanup service..."),this.config.clearCacheOnMount&&this.clearAllCaches(),this.config.preventExtensionInterference&&this.preventExtensionInterference(),this.config.enablePerformanceMonitoring&&this.initializePerformanceMonitoring(),this.startPeriodicCleanup(),this.log("info","Cache cleanup service initialized")}clearAllCaches(){try{if(window.sessionStorage){let e={};["user-preference","auth-state"].forEach(t=>{let r=window.sessionStorage.getItem(t);r&&(e[t]=r)}),window.sessionStorage.clear(),Object.entries(e).forEach(e=>{let[t,r]=e;window.sessionStorage.setItem(t,r)})}window.localStorage&&Object.keys(window.localStorage).filter(e=>e.includes("cache")||e.includes("temp")||e.includes("prefetch")||e.startsWith("_next")).forEach(e=>{window.localStorage.removeItem(e)}),this.log("info","Browser caches cleared")}catch(e){this.log("warn","Failed to clear some caches:",e)}}preventExtensionInterference(){try{let e=document.createElement;document.createElement=function(t){let r=e.call(this,t);if("script"===t.toLowerCase()){let e=r.setAttribute;r.setAttribute=function(t,r){return"src"===t&&r.includes("chrome-extension://")?void console.warn("Blocked potential extension script injection:",r):e.call(this,t,r)}}return r},this.log("info","Extension interference prevention enabled")}catch(e){this.log("warn","Failed to prevent extension interference:",e)}}initializePerformanceMonitoring(){if(window.PerformanceObserver)try{this.performanceObserver=new PerformanceObserver(e=>{e.getEntries().forEach(e=>{if("navigation"===e.entryType){let t=e.loadEventEnd-e.fetchStart;t>5e3&&this.log("warn","Slow navigation detected: ".concat(t,"ms"))}if("resource"===e.entryType){let t=e.responseEnd-e.fetchStart;t>3e3&&this.log("warn","Slow resource loading: ".concat(e.name," (").concat(t,"ms)"))}})}),this.performanceObserver.observe({entryTypes:["navigation","resource","measure"]}),this.log("info","Performance monitoring enabled")}catch(e){this.log("warn","Failed to initialize performance monitoring:",e)}}startPeriodicCleanup(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cleanupInterval=setInterval(()=>{this.performMaintenanceCleanup()},3e5)}performMaintenanceCleanup(){try{if(window.localStorage){let e=Date.now();Object.keys(window.localStorage).forEach(t=>{t.includes("expires_")&&parseInt(window.localStorage.getItem(t)||"0")<e&&(window.localStorage.removeItem(t),window.localStorage.removeItem(t.replace("expires_","")))})}this.log("debug","Maintenance cleanup completed")}catch(e){this.log("warn","Maintenance cleanup failed:",e)}}emergencyCleanup(){this.log("warn","Performing emergency cleanup...");try{this.clearAllCaches(),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=null),this.log("info","Emergency cleanup completed")}catch(e){this.log("warn","Emergency cleanup failed:",e)}}updateConfig(e){this.config={...this.config,...e}}destroy(){this.log("info","Destroying cache cleanup service..."),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=null),this.log("info","Cache cleanup service destroyed")}log(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];if("silent"!==this.config.logLevel&&("warn"===e||"info"===e&&["info","debug"].includes(this.config.logLevel)||"debug"===e&&"debug"===this.config.logLevel)){let r="[CacheCleanup]";"warn"===e?console.warn(r,t,...i):console.log(r,t,...i)}}constructor(e={}){this.cleanupInterval=null,this.performanceObserver=null,this.config={clearCacheOnMount:!0,preventExtensionInterference:!0,enablePerformanceMonitoring:!0,logLevel:"warn",...e}}}let v=y.getInstance();class x{async initialize(){if(!this.isInitialized)try{await this.initializeCoreServices(),this.config.monitoringEnabled&&this.startHealthMonitoring(),this.setupErrorTracking(),this.isInitialized=!0,console.log("System Integration Service initialized successfully")}catch(e){throw console.error("Failed to initialize System Integration Service:",e),e}}async initializeCoreServices(){v.initialize(),l.Ew.updateConfig({enablePrefetch:!0,retryAttempts:3,timeout:8e3,fallbackRoute:"/main"}),f.updateConfig({retryAttempts:2,timeout:1e4,enableCache:!0,cacheDuration:3e5}),f.cleanupCache()}startHealthMonitoring(){this.healthCheckTimer=setInterval(()=>{this.performHealthCheck()},this.config.healthCheckInterval)}async performHealthCheck(){let e={status:"healthy",services:{navigation:this.checkNavigationHealth(),fetch:this.checkFetchHealth(),cache:this.checkCacheHealth()},metrics:{errorCount:this.errorCount,lastError:this.lastError},timestamp:new Date().toISOString()},t=Object.values(e.services).filter(e=>!e).length;return t>0&&(e.status=t>=2?"critical":"degraded"),this.config.enableAutoRecovery&&"healthy"!==e.status&&await this.attemptAutoRecovery(e),this.lastHealthReport=e,e}checkNavigationHealth(){try{return"function"==typeof l.Ew.navigateWithRetry}catch(e){return console.error("Navigation health check failed:",e),!1}}checkFetchHealth(){try{return"function"==typeof f.fetchWithRetry}catch(e){return console.error("Fetch health check failed:",e),!1}}checkCacheHealth(){try{return"function"==typeof v.clearAllCaches}catch(e){return console.error("Cache health check failed:",e),!1}}async attemptAutoRecovery(e){console.warn("System degradation detected, attempting auto-recovery...");try{e.services.cache||(v.emergencyCleanup(),v.initialize()),this.errorCount=0,this.lastError=void 0,console.log("Auto-recovery completed")}catch(e){console.error("Auto-recovery failed:",e)}}setupErrorTracking(){this.setupErrorCountReset(),window.addEventListener("error",this.handleGlobalError.bind(this)),window.addEventListener("unhandledrejection",this.handleGlobalRejection.bind(this))}setupErrorCountReset(){this.errorCountResetTimer=setInterval(()=>{this.errorCount=0},6e4)}handleGlobalError(e){var t;this.errorCount++,this.lastError=(null==(t=e.error)?void 0:t.message)||"Unknown error",console.error("Global error detected:",e.error),this.errorCount>=this.config.maxErrorsPerMinute&&this.emergencyCleanup()}handleGlobalRejection(e){var t;this.errorCount++,this.lastError=(null==(t=e.reason)?void 0:t.message)||"Promise rejection",console.error("Global promise rejection:",e.reason),this.errorCount>=this.config.maxErrorsPerMinute&&this.emergencyCleanup()}emergencyCleanup(){console.warn("Emergency cleanup initiated due to high error rate");try{v.emergencyCleanup(),f.cleanup(),this.errorCount=0,this.lastError=void 0}catch(e){console.error("Emergency cleanup failed:",e)}}getHealthReport(){return this.lastHealthReport||null}isSystemReady(){return this.isInitialized&&this.errorCount<this.config.maxErrorsPerMinute}updateConfig(e){this.config={...this.config,...e}}shutdown(){this.healthCheckTimer&&clearInterval(this.healthCheckTimer),this.errorCountResetTimer&&clearInterval(this.errorCountResetTimer),v.destroy(),f.cleanup(),this.isInitialized=!1,console.log("System Integration Service shut down")}constructor(){this.config={healthCheckInterval:3e4,maxErrorsPerMinute:5,enableAutoRecovery:!0,monitoringEnabled:!0},this.isInitialized=!1,this.errorCount=0}}let w=new x;function b(e){let{children:t}=e,[r,c]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),m=(0,s.usePathname)();return((0,a.useEffect)(()=>((async()=>{try{await w.initialize(),d(!0),console.log("Science for Action system fully initialized")}catch(e){console.error("System initialization failed:",e),d(!0)}})(),()=>{w.shutdown()}),[]),(0,a.useEffect)(()=>{if(!l)return;let e=setInterval(()=>{let e=w.getHealthReport();e&&"critical"===e.status&&console.warn("System health critical:",e)},3e4);return()=>{clearInterval(e)}},[l]),"/"===m)?(0,i.jsx)(i.Fragment,{children:t}):l?(0,i.jsx)(p,{children:(0,i.jsxs)("div",{className:"flex w-full min-h-screen bg-background",children:[(0,i.jsx)("div",{className:"hidden lg:block",children:(0,i.jsx)(h,{})}),(0,i.jsx)("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:(0,i.jsx)("button",{onClick:()=>c(!0),className:"p-3 bg-card border border-grayBorder rounded-xl shadow-sm hover:scale-105 active:scale-95 transition-transform","aria-label":"Open navigation menu",children:(0,i.jsx)("svg",{className:"w-6 h-6 text-text",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})}),(0,i.jsx)(u,{isOpen:r,onClose:()=>c(!1)}),(0,i.jsx)("div",{className:"flex-1 lg:ml-0",children:(0,i.jsx)(n.N,{mode:"wait",children:(0,i.jsx)(o.P.div,{initial:"initial",animate:"in",exit:"out",variants:{initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},transition:{type:"tween",ease:"anticipate",duration:.4},children:(0,i.jsx)("div",{className:"min-h-screen",children:t})},m)})})]})}):(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background",children:(0,i.jsxs)("div",{className:"text-center space-y-4",children:[(0,i.jsx)("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full mx-auto animate-spin"}),(0,i.jsx)("p",{className:"text-grayText",children:"Initializing Science for Action..."}),(0,i.jsx)("p",{className:"text-xs text-grayText/70",children:"Setting up error handling & navigation systems"})]})})}},5063:(e,t,r)=>{"use strict";r.d(t,{Ew:()=>a});class i{static getInstance(e){return i.instance||(i.instance=new i(e)),i.instance}async validateRoute(e){try{if(!e||"/"===e||!e.startsWith("/"))return!1;return["/main","/explore","/tool","/profile","/admin","/action"].some(t=>e===t||e.startsWith(t+"/"))}catch(e){return console.warn("Route validation failed:",e),!1}}safeEncodeURIComponent(e){try{if(!e||"string"!=typeof e)return"";return encodeURIComponent(e.trim())}catch(t){return console.warn("URI encoding failed:",e,t),e.replace(/[^a-zA-Z0-9-_.~]/g,"")}}buildActionRoute(e){try{let{intent:t,topic:r,location:i}=e;if(!t||!r)return console.warn("Missing required route parameters:",e),null;let a=this.safeEncodeURIComponent(t),n=this.safeEncodeURIComponent(r);if(!a||!n)return console.warn("Failed to encode route parameters:",e),null;let o="/action/".concat(a,"/").concat(n);if(i&&i.trim()){let e=this.safeEncodeURIComponent(i);e&&(o+="?location=".concat(e))}return o}catch(t){return console.error("Route building failed:",e,t),null}}async navigateWithRetry(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{replace:i=!1,scroll:a=!0}=r;for(let r=0;r<=this.config.retryAttempts;r++)try{return await this.validateRoute(t)||(console.warn("Invalid route detected: ".concat(t,", using fallback")),t=this.config.fallbackRoute),i?e.replace(t,{scroll:a}):e.push(t,{scroll:a}),!0}catch(t){if(console.warn("Navigation attempt ".concat(r+1," failed:"),t),r<this.config.retryAttempts){await this.delay(this.retryDelays[r]||500);continue}try{console.error("All navigation attempts failed, using emergency fallback"),e.replace(this.config.fallbackRoute);break}catch(e){console.error("Emergency fallback navigation failed:",e);break}}return!1}async smartPrefetch(e,t){if(this.config.enablePrefetch)try{if(!await this.validateRoute(t))return void console.warn("Skipping prefetch for invalid route: ".concat(t));e&&"function"==typeof e.prefetch&&t&&await Promise.race([e.prefetch(t),this.delay(this.config.timeout)])}catch(e){console.warn("Prefetch failed (non-critical):",t,e)}}async navigateToAction(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let i=this.buildActionRoute(t);if(!i)return console.error("Failed to build action route, using fallback"),this.navigateWithRetry(e,"/tool");return!1!==r.prefetch&&this.config.enablePrefetch&&this.smartPrefetch(e,i).catch(()=>{}),this.navigateWithRetry(e,i,{replace:r.replace,scroll:!0})}catch(r){return console.error("Action navigation failed:",t,r),this.navigateWithRetry(e,"/tool")}}async navigateTo(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let i=t;if(r.params&&r.params.toString()){let e=t.includes("?")?"&":"?";i="".concat(t).concat(e).concat(r.params.toString())}return!1!==r.prefetch&&this.config.enablePrefetch&&this.smartPrefetch(e,i).catch(()=>{}),this.navigateWithRetry(e,i,{replace:r.replace,scroll:!0})}catch(r){return console.error("Navigation failed:",t,r),this.navigateWithRetry(e,this.config.fallbackRoute)}}emergencyNavigate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/main";try{window.location.href=e}catch(e){console.error("Emergency navigation failed:",e),window.location.reload()}}delay(e){return new Promise(t=>setTimeout(t,e))}parseSearchParams(e){let t={};try{e&&e.forEach((e,r)=>{e&&r&&(t[r]=decodeURIComponent(e))})}catch(e){console.warn("Search params parsing failed:",e)}return t}updateConfig(e){this.config={...this.config,...e}}constructor(e={}){this.retryDelays=[100,300,500],this.config={enablePrefetch:!0,retryAttempts:2,timeout:5e3,fallbackRoute:"/main",...e}}}let a=i.getInstance()},6738:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2093,23)),Promise.resolve().then(r.t.bind(r,7735,23)),Promise.resolve().then(r.t.bind(r,347,23)),Promise.resolve().then(r.bind(r,2919)),Promise.resolve().then(r.bind(r,7083)),Promise.resolve().then(r.bind(r,7271)),Promise.resolve().then(r.bind(r,7772)),Promise.resolve().then(r.bind(r,2039))},7271:(e,t,r)=>{"use strict";r.d(t,{ExploreProvider:()=>h});var i=r(5155),a=r(2115),n=r(2039),o=r(5674);class s{async analyzeUser(e){try{let t=await o.L.getUserById(e);if(!t)return null;let r=this.classifyUserSegment(t),i=this.calculateEngagementPrediction(t),a=this.calculateChurnRisk(t),n=await this.generateNextBestActions(t),s=this.generatePersonalizedContent(t),c=this.generateUIPreferences(t);return{user_segment:r,engagement_prediction:i,churn_risk:a,next_best_actions:n,personalized_content:s,ui_preferences:c}}catch(e){return console.error("Error analyzing user:",e),null}}async generateRecommendations(e){try{let t=await o.L.getUserById(e);if(!t)return[];let r=[];t.profile_completion<100&&r.push(this.createProfileCompletionRecommendation(t));let i=await this.generateActionRecommendations(t);r.push(...i);let a=this.generateEngagementRecommendations(t);r.push(...a);let n=await this.generateCommunityRecommendations(t);return r.push(...n),r.sort((e,t)=>{let r={urgent:4,high:3,medium:2,low:1};return e.priority!==t.priority?r[t.priority]-r[e.priority]:t.confidence-e.confidence})}catch(e){return console.error("Error generating recommendations:",e),[]}}async generateSystemInsights(){try{let e=[],t=await o.L.getEngagementStats();e.push({insight_type:"engagement",title:"User Engagement Overview",description:"Analysis of user activity and engagement patterns",data_points:[{label:"Total Users",value:t.total_users},{label:"Active Users",value:t.active_users},{label:"Completion Rate",value:"".concat(t.completion_rate.toFixed(1),"%")},{label:"New Users (7d)",value:t.new_users_this_week}],actionable_items:["Focus on user retention strategies","Improve action completion flow","Enhance new user onboarding"],confidence_score:.92});let r=await o.L.getRealTimeMetrics();e.push({insight_type:"trend",title:"Real-Time System Health",description:"Current system performance and user activity",data_points:[{label:"Active Sessions",value:r.active_sessions,trend:r.active_sessions>50?"up":"stable"},{label:"Actions in Progress",value:r.actions_in_progress,trend:"stable"},{label:"Recent Completions",value:r.recent_completions,trend:r.recent_completions>10?"up":"down"}],actionable_items:["Monitor system performance","Scale resources if needed","Optimize database queries"],confidence_score:.88});let i=await this.generateImpactInsight();return i&&e.push(i),e}catch(e){return console.error("Error generating system insights:",e),[]}}generateAdaptiveExploreContent(e){if(!e)return{heroMessage:"Discover actions that create meaningful change in your community",callToAction:"Start exploring actions that match your interests",featuredActions:["Climate Action","Community Volunteering","Social Justice"],personalizedTips:["Create a profile to get personalized recommendations","Browse actions by category to find what interests you","Start with easy actions to build momentum"]};let t=this.classifyUserSegment(e),r=this.models.content.templates;return{heroMessage:this.selectRandomTemplate(r.motivational,e),callToAction:this.selectRandomTemplate(r.calls_to_action,e),featuredActions:e.interests.slice(0,3),personalizedTips:this.generatePersonalizedTips(e,t)}}generateAdaptiveActionCard(e,t){let r=t?this.calculateActionRelevance(e,t):.5;return{priority:this.calculateActionPriority(e,t),relevanceScore:r,personalizedDescription:this.personalizeActionDescription(e,t),difficultyAdjustment:this.adjustDifficultyForUser(e,t),estimatedTimeForUser:this.estimateTimeForUser(e,t)}}generateRealTimeUIAdaptations(e,t){let r=(null==e?void 0:e.personalization)||{layout_preference:"detailed",color_scheme:"neutral",engagement_level:"medium",communication_frequency:"weekly"};return{layout:this.generateLayoutAdaptations(r,t),animations:this.generateAnimationSettings(r),colorScheme:this.generateColorScheme(r.color_scheme),contentDensity:this.determineContentDensity(e)}}async optimizeExploreFeed(e,t){try{if(!e)return await o.L.getPopularActions(20);let r=await o.L.getUserById(e);if(!r)return t;let i=await o.L.getPersonalizedActions(e,15),a=await o.L.getPopularActions(10);return[...i,...a].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id)).sort((e,t)=>{let i=this.calculateActionScore(e,r);return this.calculateActionScore(t,r)-i})}catch(e){return console.error("Error optimizing explore feed:",e),t}}classifyUserSegment(e){let{actions_completed:t}=e.contribution_stats,r=Math.floor((Date.now()-new Date(e.created_at).getTime())/864e5);return 0===t&&r<=7?"new_user":t<=10&&r<=30?"casual_user":t<=50&&r<=90?"active_user":t>50?"power_user":Math.floor((Date.now()-new Date(e.last_active).getTime())/864e5)>30?"at_risk":"casual_user"}calculateEngagementPrediction(e){let t=this.models.engagement.weights,r=Math.max(0,1-Math.floor((Date.now()-new Date(e.last_active).getTime())/864e5)/30),i=Math.min(1,e.engagement_metrics.session_count/50),a=Math.min(1,e.contribution_stats.actions_completed/20);return r*t.recency+i*t.frequency+a*t.depth}calculateChurnRisk(e){let t=Math.floor((Date.now()-new Date(e.last_active).getTime())/864e5);return t>60?.9:t>30?.7:t>14?.4:t>7?.2:.1}async generateNextBestActions(e){try{return(await o.L.getPersonalizedActions(e.id,5)).map(t=>({...t,score:this.calculateActionScore(t,e)})).sort((e,t)=>t.score-e.score).slice(0,3)}catch(e){return console.error("Error generating next best actions:",e),[]}}generatePersonalizedContent(e){let{actions_completed:t,total_impact_score:r}=e.contribution_stats,i=this.models.content.templates;return{hero_message:this.selectRandomTemplate(i.motivational,e),call_to_action:this.selectRandomTemplate(i.calls_to_action,e),motivational_quote:this.selectRandomTemplate(i.motivational,e),progress_message:this.interpolateTemplate(i.progress[Math.floor(Math.random()*i.progress.length)],{count:t,score:r,percent:Math.floor(r/1e3*100),percentile:Math.floor(20*Math.random())+80,orgs:e.contribution_stats.organizations_supported})}}generateUIPreferences(e){let t=this.calculateEngagementPrediction(e),r=e.personalization;return{layout:"visual"===r.layout_preference?"standard":r.layout_preference,color_scheme:r.color_scheme,animation_level:t>.7?"dynamic":t>.4?"moderate":"subtle",information_density:"minimal"===r.layout_preference?"low":"visual"===r.layout_preference?"medium":"high"}}createProfileCompletionRecommendation(e){let t=[];return e.email||t.push("email"),e.location||t.push("location"),0===e.interests.length&&t.push("interests"),0===e.preferred_causes.length&&t.push("preferred causes"),{id:"profile_completion_".concat(e.id),type:"profile_improvement",title:"Complete Your Profile",description:"Add ".concat(t.join(", ")," to get better recommendations"),priority:"medium",confidence:.9,estimated_impact:25,metadata:{missing_fields:t}}}async generateActionRecommendations(e){try{return(await o.L.getPersonalizedActions(e.id,3)).map((t,r)=>({id:"action_rec_".concat(t.id),type:"action",title:"Try: ".concat(t.title),description:t.description,priority:0===r?"high":"medium",confidence:this.calculateActionRelevance(t,e),estimated_impact:this.estimateActionImpact(t),metadata:{action_id:t.id,category:t.category}}))}catch(e){return console.error("Error generating action recommendations:",e),[]}}generateEngagementRecommendations(e){let t=[],r=this.calculateEngagementPrediction(e);return r<.3&&t.push({id:"engagement_boost_".concat(e.id),type:"engagement",title:"Boost Your Engagement",description:"Try setting a weekly action goal to stay motivated",priority:"medium",confidence:.75,estimated_impact:40,metadata:{current_engagement:r}}),t}async generateCommunityRecommendations(e){try{let t=await o.L.getUsersByInterest(e.interests[0]||"Climate Change");if(t.length>10)return[{id:"community_".concat(e.id),type:"community",title:"Join Your Community",description:"Connect with ".concat(t.length," others who share your interests"),priority:"low",confidence:.6,estimated_impact:20,metadata:{similar_users_count:t.length}}];return[]}catch(e){return console.error("Error generating community recommendations:",e),[]}}async generateImpactInsight(){try{let e=await o.L.getEngagementStats();return{insight_type:"impact",title:"Community Impact Analysis",description:"Collective impact of user actions across the platform",data_points:[{label:"Actions Completed",value:e.completion_rate*e.total_users},{label:"Organizations Supported",value:Math.floor(.3*e.total_users)},{label:"Estimated Reach",value:Math.floor(5.2*e.total_users)}],actionable_items:["Showcase success stories","Create impact visualization","Encourage peer sharing"],confidence_score:.85}}catch(e){return console.error("Error generating impact insight:",e),null}}calculateActionRelevance(e,t){let r=.5;return t.interests.some(t=>e.tags.includes(t)||e.category.includes(t))&&(r+=.3),t.preferred_causes.some(t=>e.tags.includes(t)||e.category.includes(t))&&(r+=.2),Math.min(1,r)}calculateActionPriority(e,t){let r;return r=50+Math.min(30,e.completion_count/10),t&&(r+=20*this.calculateActionRelevance(e,t)),Math.min(100,r)}calculateActionScore(e,t){let r=this.calculateActionRelevance(e,t);return .5*r+.3*Math.min(1,e.completion_count/1e3)+.2}selectRandomTemplate(e,t){return e[Math.floor(Math.random()*e.length)]}interpolateTemplate(e,t){return e.replace(/\{(\w+)\}/g,(e,r)=>{var i;return(null==(i=t[r])?void 0:i.toString())||e})}personalizeActionDescription(e,t){if(!t)return e.description;let r=t.interests.find(t=>e.category.toLowerCase().includes(t.toLowerCase()));return r?"".concat(e.description," This aligns with your interest in ").concat(r,"."):e.description}adjustDifficultyForUser(e,t){if(!t)return e.difficulty;let r=t.contribution_stats.actions_completed;return 0===r&&"hard"===e.difficulty?"Consider starting with easier actions first":r>20&&"easy"===e.difficulty?"This should be quick for you!":"".concat(e.difficulty," difficulty")}estimateTimeForUser(e,t){return e.time_commitment}estimateActionImpact(e){return({low:20,medium:50,high:80})[e.impact_level]||50}generatePersonalizedTips(e,t){let r={new_user:["Start with actions that match your interests","Set a goal to complete one action this week","Explore different categories to find your passion"],casual_user:["Try increasing your impact with medium-difficulty actions","Connect with others who share your interests","Track your progress to stay motivated"],active_user:["Consider organizing actions in your community","Share your experience to inspire others","Try high-impact actions for greater change"],power_user:["Mentor new users to expand the community","Lead initiatives in your area of expertise","Help improve the platform with feedback"],at_risk:["We miss you! Check out what's new","Find actions that fit your current schedule","Small actions can make a big difference"]};return r[t]||r.casual_user}generateLayoutAdaptations(e,t){return{containerWidth:"minimal"===e.layout_preference?"narrow":"wide",cardSpacing:"visual"===e.layout_preference?"loose":"compact",showSidebar:"minimal"!==e.layout_preference}}generateAnimationSettings(e){let t=e.engagement_level;return{duration:"high"===t?"normal":"medium"===t?"fast":"instant",complexity:"high"===t?"rich":"simple"}}generateColorScheme(e){let t={warm:{primary:"#ff6b35",secondary:"#f7931e"},cool:{primary:"#4285f4",secondary:"#34a853"},neutral:{primary:"#6c757d",secondary:"#495057"}};return t[e]||t.neutral}determineContentDensity(e){if(!e)return"medium";let t=e.contribution_stats.actions_completed;return t>50?"high":t>10?"medium":"low"}constructor(){this.models={engagement:{weights:{recency:.3,frequency:.4,depth:.3},thresholds:{low:.3,medium:.6,high:.8}},personalization:{segments:{new_user:{max_actions:2,max_days:7},casual_user:{max_actions:10,max_days:30},active_user:{max_actions:50,max_days:90},power_user:{min_actions:50}}},content:{templates:{motivational:["Your actions are creating real change in the world!","Every step counts towards a better tomorrow.","You're part of a growing movement for positive change.","Your commitment to action inspires others to follow."],progress:["You've completed {count} actions this month!","Your impact score has increased by {percent}%","You're in the top {percentile}% of engaged users","You've supported {orgs} different organizations"],calls_to_action:["Ready to take your next action?","Find actions that match your passions","Explore opportunities in your area","Join others making a difference"]}}}}}let c=new s;var l=r(607);let d=(0,a.createContext)(void 0);function h(e){let{children:t}=e,{profile:r}=(0,n.x)(),[s,h]=(0,a.useState)([]),[m,u]=(0,a.useState)(!0),[p,g]=(0,a.useState)(""),[f,y]=(0,a.useState)(0),[v,x]=(0,a.useState)(!0),[w,b]=(0,a.useState)({categories:[],tags:[],locations:[],impactRange:[1,5],timeCommitments:[],difficulties:[],onlyTrending:!1,onlyFeatured:!1}),_=(0,a.useMemo)(()=>new l.A(s,{keys:["title","description","tags","category","organization"],threshold:.3,includeScore:!0}),[s]);(0,a.useEffect)(()=>{C()},[]),(0,a.useEffect)(()=>{r&&j()},[r]);let C=async()=>{u(!0);try{let e=(await o.L.getActions(50,0)).map(k);h(e),y(1)}catch(e){console.error("Error loading initial items:",e)}finally{u(!1)}},j=async()=>{if(r)try{let e=await o.L.getPersonalizedActions(r.id,20),t=await Promise.all(e.map(async e=>{let t=c.generateAdaptiveActionCard(e,r);return{...k(e),relevance:Math.round(5*t.relevanceScore),impact:t.priority/20}}));h(e=>{let r=new Set(e.map(e=>e.id));return t.filter(e=>!r.has(e.id)),[...t,...e.filter(e=>!t.some(t=>t.id===e.id))]})}catch(e){console.error("Error loading personalized items:",e)}},k=e=>({id:e.id,title:e.title,description:e.description,tags:e.tags,category:e.category,impact:({low:2,medium:3,high:5})[e.impact_level]||3,relevance:3,time_commitment:e.time_commitment,organization:e.organization,location:e.location||void 0,trending:e.completion_count>100,featured:e.completion_count>500,difficulty:e.difficulty,impact_level:e.impact_level,completion_count:e.completion_count,created_at:e.created_at,updated_at:e.updated_at}),E=(0,a.useMemo)(()=>{let e=s;return p.trim()&&(e=_.search(p).map(e=>e.item)),w.categories.length>0&&(e=e.filter(e=>w.categories.includes(e.category))),w.tags.length>0&&(e=e.filter(e=>w.tags.some(t=>e.tags.includes(t)))),w.difficulties.length>0&&(e=e.filter(e=>w.difficulties.includes(e.difficulty))),w.locations.length>0&&(e=e.filter(e=>e.location&&w.locations.some(t=>{var r;return null==(r=e.location)?void 0:r.toLowerCase().includes(t.toLowerCase())}))),(1!==w.impactRange[0]||5!==w.impactRange[1])&&(e=e.filter(e=>e.impact>=w.impactRange[0]&&e.impact<=w.impactRange[1])),w.timeCommitments.length>0&&(e=e.filter(e=>e.time_commitment&&w.timeCommitments.includes(e.time_commitment))),w.onlyTrending&&(e=e.filter(e=>e.trending)),w.onlyFeatured&&(e=e.filter(e=>e.featured)),e.sort((e,t)=>r?.6*t.relevance+.4*t.impact-(.6*e.relevance+.4*e.impact):t.completion_count-e.completion_count)},[s,p,w,_,r]),S=(0,a.useMemo)(()=>s.filter(e=>e.trending).sort((e,t)=>t.completion_count-e.completion_count).slice(0,10),[s]),N=(0,a.useMemo)(()=>r?s.filter(e=>[...r.interests,...r.preferred_causes].some(t=>e.tags.some(e=>e.toLowerCase().includes(t.toLowerCase()))||e.category.toLowerCase().includes(t.toLowerCase()))).sort((e,t)=>t.relevance-e.relevance).slice(0,15):[],[s,r]),T=(0,a.useCallback)(e=>{g(e)},[]),R=(0,a.useCallback)(e=>{b(t=>({...t,...e}))},[]),A=(0,a.useCallback)(()=>{b({categories:[],tags:[],locations:[],impactRange:[1,5],timeCommitments:[],difficulties:[],onlyTrending:!1,onlyFeatured:!1}),g("")},[]),P=(0,a.useCallback)(async()=>{u(!0);try{let e=(await o.L.getActions(50,0)).map(k);h(e),r&&await j()}catch(e){console.error("Error refreshing items:",e)}finally{u(!1)}},[r]),I=(0,a.useCallback)(async()=>{if(!r)return[];try{return(await c.generateRecommendations(r.id)).filter(e=>"action"===e.type).map(e=>s.find(t=>t.id===e.metadata.action_id)).filter(Boolean)}catch(e){return console.error("Error getting recommendations:",e),[]}},[r,s]),z=(0,a.useCallback)(async(e,t)=>{if(r)try{"view"===t?await o.L.updateUser(r.id,{engagement_metrics:{...r.engagement_metrics,page_views:r.engagement_metrics.page_views+1}}):"click"===t&&await o.L.startAction(r.id,e)}catch(e){console.error("Error tracking interaction:",e)}},[r]),M=(0,a.useCallback)(()=>{let e={};return s.forEach(t=>{e[t.category]=(e[t.category]||0)+1}),e},[s]),L=(0,a.useCallback)(()=>{let e={};return s.forEach(t=>{t.tags.forEach(t=>{e[t]=(e[t]||0)+1})}),Object.entries(e).sort((e,t)=>{let[,r]=e,[,i]=t;return i-r}).slice(0,20).map(e=>{let[t]=e;return t})},[s]),D=(0,a.useCallback)(async()=>{if(v&&!m)try{u(!0);let e=await o.L.getActions(25,25*f);if(0===e.length)return void x(!1);let t=e.map(k);h(e=>[...e,...t]),y(e=>e+1)}catch(e){console.error("Error loading more items:",e)}finally{u(!1)}},[f,v,m]);return(0,i.jsx)(d.Provider,{value:{items:s,filteredItems:E,isLoading:m,searchQuery:p,filters:w,trendingItems:S,personalizedItems:N,updateSearchQuery:T,updateFilters:R,resetFilters:A,refreshItems:P,getRecommendations:I,trackItemInteraction:z,getByCategoryStats:M,getPopularTags:L,loadMoreItems:D},children:t})}},7772:(e,t,r)=>{"use strict";r.d(t,{InteractionProvider:()=>s});var i=r(5155),a=r(2115);let n=(0,a.createContext)(void 0),o={isNavigating:!1,currentStep:0,totalSteps:0,progress:0,animations:{fadeIn:!1,slideUp:!1,staggered:!1}};function s(e){let{children:t}=e,[r,s]=(0,a.useState)(o),c=(0,a.useCallback)(e=>{s(t=>({...t,isNavigating:e}))},[]),l=(0,a.useCallback)((e,t)=>{let r=t>0?e/t*100:0;s(i=>({...i,currentStep:e,totalSteps:t,progress:r}))},[]),d=(0,a.useCallback)(e=>{s(t=>({...t,animations:{...t.animations,[e]:!0}})),setTimeout(()=>{s(t=>({...t,animations:{...t.animations,[e]:!1}}))},100)},[]),h=(0,a.useCallback)(()=>{s(o)},[]);return(0,i.jsx)(n.Provider,{value:{state:r,setNavigating:c,updateProgress:l,triggerAnimation:d,resetInteraction:h},children:t})}}},e=>{e.O(0,[360,793,647,338,187,674,822,441,964,358],()=>e(e.s=6738)),_N_E=e.O()}]);